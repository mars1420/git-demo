<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="js/jsonp.js"></script>
    <script src="js/template-web.js"></script>
    <style>
        td {
            text-align: center;
        }
        
        div {
            width: 500px;
            margin: 0px auto;
        }
        
        div ul {
            list-style: none;
            display: flex;
            margin: 0px;
            padding: 0px;
        }
        
        div ul li {
            border: 1px sandybrown solid;
        }
    </style>
</head>

<body>
    <table align="center" border="1" width="500px">
        <caption>湖北省黄冈市未来48小时天气预报</caption>
        <thead>
            <th>时间</th>
            <th>天气</th>
            <th>温度</th>
            <th>风向</th>
            <th>风力</th>
        </thead>
        <tbody>

        </tbody>
    </table>
    <div>
        <h3>湖北省黄冈市未来7天天气预报</h3>
        <ul>

        </ul>
    </div>

</body>
<!-- js的模板引擎 -->
<script type="text/html" id="weather">
    {{each forecast}}
    <tr>
        <td>{{mydate($value.update_time)}}</td>
        <td>{{$value.weather}}</td>
        <td>{{$value.degree}}°</td>
        <td>{{$value.wind_direction}}</td>
        <td>{{$value.wind_power}}</td>
    </tr>
    {{/each}}
</script>
<script type="text/html" id="weather7">
    {{each forecast}}
    <li>
        <p>{{$value.time}}</p>
        <p>{{$value.day_weather}}</p>
        <p>最高{{$value.max_degree}}°</p>
        <p>最低{{$value.min_degree}}°</p>
        <p>{{$value.day_wind_direction}}-{{$value.day_wind_power}}级</p>
    </li>
    {{/each}}
</script>
<script>
    //自定义一个时间的处理函数
    function mydate(mytime) {
        //20220121110000 =====2022年01月21日11点===2022-01-21 11时
        //new String().substring
        var year = mytime.substr(0, 4);
        var month = mytime.substr(4, 2);
        var day = mytime.substr(6, 2);
        var hour = mytime.substr(8, 2);
        return year + "-" + month + "-" + day + " " + hour + "时";
    }
    //将自定义的函数导入到模板中使用
    //template.defaults.imports  用来导入外部的函数到模板中使用
    template.defaults.imports.mydate = mydate;
    jsonp({
        //请求的腾讯的天气的网站资源接口
        url: "https://wis.qq.com/weather/common",
        data: {
            source: "pc",
            weather_type: "forecast_1h|forecast_24h", //48小时的   forecast_24h 7天的
            province: "湖北省",
            city: "黄冈市"
        },
        success: function(res) {
            console.log(res);
            /* 
            degree: "6":  温度
            update_time: "20220121110000"  时间
            weather: "小雨"     天气
            weather_code: "07"   
            weather_short: "小雨"  
            wind_direction: "东风" 风向
            wind_power: "4"    风力
            */
            var html = template("weather", {
                forecast: res.data.forecast_1h
            });
            document.querySelector('tbody').innerHTML = html;
            var ulhtml = template("weather7", {
                forecast: res.data.forecast_24h
            });
            document.querySelector('ul').innerHTML = ulhtml;
        }
    });
</script>

</html>